<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  
    <title>Testharness.js API Documentation | Test the Web Forward</title>
  
  <!--[if lt IE 9]>
    <script src="/vendor/html5shim.js"></script>
  <![endif]-->
  <link rel="shortcut icon" href="http://testthewebforward.org/docs/img/favicon.ico">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="Testharness.js%20API%20Documentation%20%7C%20Test%20the%20Web%20Forward_files/bootstrap.css" rel="stylesheet" media="screen">
  <link rel="stylesheet" href="Testharness.js%20API%20Documentation%20%7C%20Test%20the%20Web%20Forward_files/glyphicons.css" type="text/css" media="screen">
  <link rel="stylesheet" href="Testharness.js%20API%20Documentation%20%7C%20Test%20the%20Web%20Forward_files/pygments.css" type="text/css" media="screen">
  <link rel="stylesheet" href="Testharness.js%20API%20Documentation%20%7C%20Test%20the%20Web%20Forward_files/custom.css" type="text/css" media="screen">
  <link rel="alternate" type="application/rss+xml" href="http://testthewebforward.org/feed.rss" title="Test the Web Forward Blog RSS feed">
<style type="text/css">
:root .container > .infoBoxList > .shareInfoBox
{ display: none !important; }</style></head>
<body data-spy="scroll" data-target="#toc-container" class="docs jstest">

  <div class="container">
    <div class="text-right">
  <img src="Testharness.js%20API%20Documentation%20%7C%20Test%20the%20Web%20Forward_files/dinos-218x50.png" height="50" width="218">
</div>
<nav class="navbar navbar-default" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://testthewebforward.org/">Test the Web Forward</a>
    </div>
  
    <div class="collapse navbar-collapse navbar-ex1-collapse  ">
      <ul class="nav navbar-nav navbar-right">
        <li class="active"><a href="http://testthewebforward.org/docs/">Docs</a></li>
        <li><a href="http://testthewebforward.org/events/">Events</a></li>
        <li><a href="http://testthewebforward.org/blog/">Blog</a></li>
      </ul>
    </div>
</div></nav>

    

    
      <div class="row">
        <div role="main" class="col-md-9">
          <article>
  <h1>Testharness.js API Documentation</h1>
  <h2 id="introduction">Introduction</h2>

<p>testharness.js provides a framework for writing testcases. It is intended to
provide a convenient API for making common assertions, and to work both
for testing synchronous and asynchronous DOM features in a way that
promotes clear, robust, tests.</p>

<h2 id="basic-usage">Basic Usage</h2>

<p>The test harness script can be used from HTML or SVG documents and web worker
scripts.</p>

<p>From an HTML or SVG document, start by importing both <code>testharness.js</code> and
<code>testharnessreport.js</code> scripts into the document:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/resources/testharness.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/resources/testharnessreport.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div>
<p>Refer to the <a href="#web-workers">Web Workers</a> section for details and an example on
testing within a web worker.</p>

<p>Within each file one may define one or more tests. Each test is atomic in the
sense that a single test has a single result (<code>PASS</code>/<code>FAIL</code>/<code>TIMEOUT</code>/<code>NOTRUN</code>).
Within each test one may have a number of asserts. The test fails at the first
failing assert, and the remainder of the test is (typically) not run.</p>

<p>If the file containing the tests is a HTML file, a table containing the test
results will be added to the document after all tests have run. By default this
will be added to a <code>div</code> element with <code>id=log</code> if it exists, or a new <code>div</code>
element appended to <code>document.body</code> if it does not.</p>

<p>NOTE: By default tests must be created before the load event fires. For ways
to create tests after the load event, see "Determining when all tests
are complete", below.</p>

<h2 id="synchronous-tests">Synchronous Tests</h2>

<p>To create a synchronous test use the <code>test()</code> function:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">test</span><span class="p">(</span><span class="nx">test_function</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">properties</span><span class="p">)</span>
</code></pre></div>
<p><code>test_function</code> is a function that contains the code to test. For example a
trivial test for the DOM
<a href="https://dom.spec.whatwg.org/#dom-domimplementation-hasfeature"><code>hasFeature()</code></a>
method (which is defined to always return true) would be:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">test</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">assert_true</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">implementation</span><span class="p">.</span><span class="nx">hasFeature</span><span class="p">());</span>
<span class="p">},</span> <span class="s2">"hasFeature() with no arguments"</span><span class="p">)</span>
</code></pre></div>
<p>The function passed in is run in the <code>test()</code> call.</p>

<p><code>properties</code> is a javascript object for passing extra options to the
test. Currently it is only used to provide test-specific
metadata, as described in the <a href="#metadata">metadata</a> section below.</p>

<h2 id="asynchronous-tests">Asynchronous Tests</h2>

<p>Testing asynchronous features is somewhat more complex since the result of
a test may depend on one or more events or other callbacks. The API provided
for testing these features is intended to be rather low-level but hopefully
applicable to many situations.</p>

<p>To create a test, one starts by getting a <code>Test</code> object using <code>async_test</code>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">async_test</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">properties</span><span class="p">)</span>
</code></pre></div>
<p>e.g.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">async_test</span><span class="p">(</span><span class="s2">"DOMContentLoaded"</span><span class="p">)</span>
</code></pre></div>
<p>Assertions can be added to the test by calling the step method of the test
object with a function containing the test assertions:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"DOMContentLoaded"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">step</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">assert_true</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">bubbles</span><span class="p">,</span> <span class="s2">"bubbles should be true"</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>When all the steps are complete, the <code>done()</code> method must be called:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">();</span>
</code></pre></div>
<p>As a convenience, <code>async_test</code> can also takes a function as first argument.
This function is called with the test object as both its <code>this</code> object and
first argument. The above example can be rewritten as:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">async_test</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"DOMContentLoaded"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">step</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">assert_true</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">bubbles</span><span class="p">,</span> <span class="s2">"bubbles should be true"</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">},</span> <span class="s2">"DOMContentLoaded"</span><span class="p">);</span>
</code></pre></div>
<p>which avoids cluttering the global scope with references to async
tests instances.</p>

<p>The properties argument is identical to that for <code>test()</code>.</p>

<p>In many cases it is convenient to run a step in response to an event or a
callback. A convenient method of doing this is through the <code>step_func</code> method
which returns a function that, when called runs a test step. For example</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"DOMContentLoaded"</span><span class="p">,</span> <span class="nx">t</span><span class="p">.</span><span class="nx">step_func</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">assert_true</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">bubbles</span><span class="p">,</span> <span class="s2">"bubbles should be true"</span><span class="p">);</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>
<p>As a further convenience, the <code>step_func</code> that calls <code>done()</code> can instead
use <code>step_func_done</code>, as follows:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"DOMContentLoaded"</span><span class="p">,</span> <span class="nx">t</span><span class="p">.</span><span class="nx">step_func_done</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">assert_true</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">bubbles</span><span class="p">,</span> <span class="s2">"bubbles should be true"</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>For asynchronous callbacks that should never execute, <code>unreached_func</code> can
be used. For example:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"DOMContentLoaded"</span><span class="p">,</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">unreached_func</span><span class="p">(</span><span class="s2">"DOMContentLoaded should not be fired on the document element"</span><span class="p">));</span>
</code></pre></div>
<p>Keep in mind that other tests could start executing before an Asynchronous
Test is finished.</p>

<h2 id="promise-tests">Promise Tests</h2>

<p><code>promise_test</code> can be used to test APIs that are based on Promises:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">promise_test</span><span class="p">(</span><span class="nx">test_function</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">properties</span><span class="p">)</span>
</code></pre></div>
<p><code>test_function</code> is a function that receives a test as an argument and returns a
promise. The test completes when the returned promise resolves. The test fails
if the returned promise rejects.</p>

<p>E.g.:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">promise_test</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">foo</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">assert_equals</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"foo should return 'foo'"</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">},</span> <span class="s2">"Simple example"</span><span class="p">);</span>
</code></pre></div>
<p>In the example above, <code>foo()</code> returns a Promise that resolves with the string
"foo". The <code>test_function</code> passed into <code>promise_test</code> invokes <code>foo</code> and attaches
a resolve reaction that verifies the returned value.</p>

<p>Note that in the promise chain constructed in <code>test_function</code> assertions don't
need to wrapped in <code>step</code> or <code>step_func</code> calls.</p>

<p>Unlike Asynchronous Tests, Promise Tests don't start running until after the
previous Promise Test finishes.</p>

<p><code>promise_rejects</code> can be used to test Promises that need to reject:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">promise_rejects</span><span class="p">(</span><span class="nx">test_object</span><span class="p">,</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">promise</span><span class="p">,</span> <span class="nx">description</span><span class="p">)</span>
</code></pre></div>
<p>The <code>code</code> argument is equivalent to the same argument to the <code>assert_throws</code>
function.</p>

<p>Here's an example where the <code>bar()</code> function returns a Promise that rejects
with a TypeError:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">bar</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nx">TypeError</span><span class="p">());</span>
<span class="p">}</span>

<span class="nx">promise_test</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">promise_rejects</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(),</span> <span class="nx">bar</span><span class="p">());</span>
<span class="p">},</span> <span class="s2">"Another example"</span><span class="p">);</span>
</code></pre></div>
<p><code>EventWatcher</code> is a constructor function that allows DOM events to be handled
using Promises, which can make it a lot easier to test a very specific series
of events, including ensuring that unexpected events are not fired at any point.</p>

<p>Here's an example of how to use <code>EventWatcher</code>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">async_test</span><span class="p">(</span><span class="s2">"Event order on animation start"</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">animation</span> <span class="o">=</span> <span class="nx">watchedNode</span><span class="p">.</span><span class="nx">getAnimations</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">eventWatcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventWatcher</span><span class="p">(</span><span class="nx">watchedNode</span><span class="p">,</span> <span class="p">[</span><span class="s1">'animationstart'</span><span class="p">,</span>
                                                  <span class="s1">'animationiteration'</span><span class="p">,</span>
                                                  <span class="s1">'animationend'</span><span class="p">]);</span>

<span class="nx">eventWatcher</span><span class="p">.</span><span class="nx">wait_for</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s1">'animationstart'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">step_func</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">assertExpectedStateAtStartOfAnimation</span><span class="p">();</span>
  <span class="nx">animation</span><span class="p">.</span><span class="nx">currentTime</span> <span class="o">=</span> <span class="nx">END_TIME</span><span class="p">;</span> <span class="c1">// skip to end</span>
  <span class="c1">// We expect two animationiteration events then an animationend event on</span>
  <span class="c1">// skipping to the end of the animation.</span>
  <span class="k">return</span> <span class="nx">eventWatcher</span><span class="p">.</span><span class="nx">wait_for</span><span class="p">([</span><span class="s1">'animationiteration'</span><span class="p">,</span>
                                <span class="s1">'animationiteration'</span><span class="p">,</span>
                                <span class="s1">'animationend'</span><span class="p">]);</span>
<span class="p">})).</span><span class="nx">then</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">step_func</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">assertExpectedStateAtEndOfAnimation</span><span class="p">();</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">();</span>
<span class="p">}));</span>
</code></pre></div>
<p><code>wait_for</code> either takes the name of a single event and returns a Promise that
will resolve after that event is fired at the watched node, or else it takes an
array of the names of a series of events and returns a Promise that will
resolve after that specific series of events has been fired at the watched node.</p>

<p><code>EventWatcher</code> will assert if an event occurs while there is no <code>wait_for</code>()
created Promise waiting to be fulfilled, or if the event is of a different type
to the type currently expected. This ensures that only the events that are
expected occur, in the correct order, and with the correct timing.</p>

<h2 id="single-page-tests">Single Page Tests</h2>

<p>Sometimes, particularly when dealing with asynchronous behaviour,
having exactly one test per page is desirable, and the overhead of
wrapping everything in functions for isolation becomes
burdensome. For these cases <code>testharness.js</code> support "single page
tests".</p>

<p>In order for a test to be interpreted as a single page test, then
it must simply not call <code>test()</code> or <code>async_test()</code> anywhere on the page, and
must call the <code>done()</code> function to indicate that the test is complete. All
the <code>assert_*</code> functions are avaliable as normal, but are called without
the normal step function wrapper. For example:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;title&gt;</span>Basic document.body test<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/resources/testharness.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/resources/testharnessreport.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">assert_equals</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"body"</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nx">done</span><span class="p">()</span>
 <span class="nt">&lt;/script&gt;</span>
</code></pre></div>
<p>The test title for single page tests is always taken from <code>document.title</code>.</p>

<h2 id="making-assertions">Making assertions</h2>

<p>Functions for making assertions start <code>assert_</code>. The full list of
asserts avaliable is documented in the <a href="#list-of-assertions">asserts</a> section
below. The general signature is</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">assert_something</span><span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">description</span><span class="p">)</span>
</code></pre></div>
<p>although not all assertions precisely match this pattern e.g. <code>assert_true</code>
only takes <code>actual</code> and <code>description</code> as arguments.</p>

<p>The description parameter is used to present more useful error messages when
a test fails</p>

<p>NOTE: All asserts must be located in a <code>test()</code> or a step of an
<code>async_test()</code>, unless the test is a single page test. Asserts outside
these places won't be detected correctly by the harness and may cause
unexpected exceptions that will lead to an error in the harness.</p>

<h2 id="cleanup">Cleanup</h2>

<p>Occasionally tests may create state that will persist beyond the test itself.
In order to ensure that tests are independent, such state should be cleaned
up once the test has a result. This can be achieved by adding cleanup
callbacks to the test. Such callbacks are registered using the <code>add_cleanup</code>
function on the test object. All registered callbacks will be run as soon as
the test result is known. For example</p>
<div class="highlight"><pre><code class="language-js" data-lang="js">  <span class="nx">test</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"div"</span><span class="p">);</span>
    <span class="nx">element</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"null"</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">add_cleanup</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">});</span>
    <span class="nx">assert_equals</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="kc">null</span><span class="p">),</span> <span class="nx">element</span><span class="p">);</span>
  <span class="p">},</span> <span class="s2">"Calling document.getElementById with a null argument."</span><span class="p">);</span>
</code></pre></div>
<h2 id="timeouts-in-tests">Timeouts in Tests</h2>

<p>In general the use of timeouts in tests is discouraged because this is
an observed source of instability in real tests when run on CI
infrastructure. In particular if a test should fail when something
doesn't happen, it is good practice to simply let the test run to the
full timeout rather than trying to guess an appropriate shorter
timeout to use.</p>

<p>In other cases it may be necessary to use a timeout (e.g., for a test
that only passes if some event is <em>not</em> fired). In this case it is
<em>not</em> permitted to use the standard <code>setTimeout</code> function. Instead one
must use the <code>step_timeout</code> function:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">async_test</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">gotEvent</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"DOMContentLoaded"</span><span class="p">,</span> <span class="nx">t</span><span class="p">.</span><span class="nx">step_func</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">assert_false</span><span class="p">(</span><span class="nx">gotEvent</span><span class="p">,</span> <span class="s2">"Unexpected DOMContentLoaded event"</span><span class="p">);</span>
    <span class="nx">gotEvent</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">step_timeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">();</span> <span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">},</span> <span class="s2">"Only one DOMContentLoaded"</span><span class="p">);</span>
</code></pre></div>
<p>The difference between <code>setTimeout</code> and <code>step_timeout</code> is that the
latter takes account of the timeout multiplier when computing the
delay; e.g., in the above case a timeout multiplier of 2 would cause a
pause of 4000ms before calling the callback. This makes it less likely
to produce unstable results in slow configurations.</p>

<p>Note that timeouts generally need to be a few seconds long in order to
produce stable results in all test environments.</p>

<p>For single-page tests, <code>step_timeout</code> is also available as a global
function.</p>

<h2 id="harness-timeout">Harness Timeout</h2>

<p>The overall harness admits two timeout values <code>"normal"</code> (the
default) and <code>"long"</code>, used for tests which have an unusually long
runtime. After the timeout is reached, the harness will stop
waiting for further async tests to complete. By default the
timeouts are set to 10s and 60s, respectively, but may be changed
when the test is run on hardware with different performance
characteristics to a common desktop computer.  In order to opt-in
to the longer test timeout, the test must specify a meta element:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"timeout"</span> <span class="na">content=</span><span class="s">"long"</span><span class="nt">&gt;</span>
</code></pre></div>
<p>Occasionally tests may have a race between the harness timing out and
a particular test failing; typically when the test waits for some event
that never occurs. In this case it is possible to use <code>test.force_timeout()</code>
in place of <code>assert_unreached()</code>, to immediately fail the test but with a
status of <code>TIMEOUT</code>. This should only be used as a last resort when it is
not possible to make the test reliable in some other way.</p>

<h2 id="setup">Setup</h2>

<p>Sometimes tests require non-trivial setup that may fail. For this purpose
there is a <code>setup()</code> function, that may be called with one or two arguments.
The two argument version is:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">setup</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">properties</span><span class="p">)</span>
</code></pre></div>
<p>The one argument versions may omit either argument.
func is a function to be run synchronously. <code>setup()</code> becomes a no-op once
any tests have returned results. Properties are global properties of the test
harness. Currently recognised properties are:</p>

<p><code>explicit_done</code> - Wait for an explicit call to done() before declaring all
tests complete (see below; implicitly true for single page tests)</p>

<p><code>output_document</code> - The document to which results should be logged. By default
this is the current document but could be an ancestor document in some cases
e.g. a SVG test loaded in an HTML wrapper</p>

<p><code>explicit_timeout</code> - disable file timeout; only stop waiting for results
when the <code>timeout()</code> function is called (typically for use when integrating
with some existing test framework that has its own timeout mechanism).</p>

<p><code>allow_uncaught_exception</code> - don't treat an uncaught exception as an error;
needed when e.g. testing the <code>window.onerror</code> handler.</p>

<p><code>timeout_multiplier</code> - Multiplier to apply to per-test timeouts.</p>

<h2 id="determining-when-all-tests-are-complete">Determining when all tests are complete</h2>

<p>By default the test harness will assume there are no more results to come
when:</p>

<ol>
<li>There are no <code>Test</code> objects that have been created but not completed</li>
<li>The load event on the document has fired</li>
</ol>

<p>This behaviour can be overridden by setting the <code>explicit_done</code> property to
true in a call to <code>setup()</code>. If <code>explicit_done</code> is true, the test harness will
not assume it is done until the global <code>done()</code> function is called. Once <code>done()</code>
is called, the two conditions above apply like normal.</p>

<p>Dedicated and shared workers don't have an event that corresponds to the <code>load</code>
event in a document. Therefore these worker tests always behave as if the
<code>explicit_done</code> property is set to true. Service workers depend on the
<a href="https://slightlyoff.github.io/ServiceWorker/spec/service_worker/index.html#service-worker-global-scope-install-event">install</a>
event which is fired following the completion of <a href="https://html.spec.whatwg.org/multipage/workers.html#run-a-worker">running the
worker</a>.</p>

<h2 id="generating-tests">Generating tests</h2>

<p>There are scenarios in which is is desirable to create a large number of
(synchronous) tests that are internally similar but vary in the parameters
used. To make this easier, the <code>generate_tests</code> function allows a single
function to be called with each set of parameters in a list:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">generate_tests</span><span class="p">(</span><span class="nx">test_function</span><span class="p">,</span> <span class="nx">parameter_lists</span><span class="p">,</span> <span class="nx">properties</span><span class="p">)</span>
</code></pre></div>
<p>For example:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">generate_tests</span><span class="p">(</span><span class="nx">assert_equals</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">"Sum one and one"</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"Sum one and zero"</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">])</span>
</code></pre></div>
<p>Is equivalent to:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">test</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="nx">assert_equals</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)},</span> <span class="s2">"Sum one and one"</span><span class="p">)</span>
<span class="nx">test</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="nx">assert_equals</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)},</span> <span class="s2">"Sum one and zero"</span><span class="p">)</span>
</code></pre></div>
<p>Note that the first item in each parameter list corresponds to the name of
the test.</p>

<p>The properties argument is identical to that for <code>test()</code>. This may be a
single object (used for all generated tests) or an array.</p>

<h2 id="callback-api">Callback API</h2>

<p>The framework provides callbacks corresponding to 4 events:</p>

<ul>
<li><code>start</code> - triggered when the first Test is created</li>
<li><code>test_state</code> - triggered when a test state changes</li>
<li><code>result</code> - triggered when a test result is received</li>
<li><code>complete</code> - triggered when all results are received</li>
</ul>

<p>The page defining the tests may add callbacks for these events by calling
the following methods:</p>

<p><code>add_start_callback(callback)</code> - callback called with no arguments</p>

<p><code>add_test_state_callback(callback)</code> - callback called with a test argument</p>

<p><code>add_result_callback(callback)</code> - callback called with a test argument</p>

<p><code>add_completion_callback(callback)</code> - callback called with an array of tests
                                        and an status object</p>

<p>tests have the following properties:</p>

<ul>
<li><p><code>status</code> - A status code. This can be compared to the <code>PASS</code>, <code>FAIL</code>,
           <code>TIMEOUT</code> and <code>NOTRUN</code> properties on the test object</p></li>
<li><p><code>message</code> - A message indicating the reason for failure. In the future this
            will always be a string</p></li>
</ul>

<p>The status object gives the overall status of the harness. It has the
 following properties:</p>

<ul>
<li><p><code>status</code> - Can be compared to the <code>OK</code>, <code>ERROR</code> and <code>TIMEOUT</code> properties</p></li>
<li><p><code>message</code> - An error message set when the status is <code>ERROR</code></p></li>
</ul>

<h2 id="external-api">External API</h2>

<p>In order to collect the results of multiple pages containing tests, the test
harness will, when loaded in a nested browsing context, attempt to call
certain functions in each ancestor and opener browsing context:</p>

<ul>
<li>start - <code>start_callback</code></li>
<li>test_state - <code>test_state_callback</code></li>
<li>result - <code>result_callback</code></li>
<li>complete - <code>completion_callback</code></li>
</ul>

<p>These are given the same arguments as the corresponding internal callbacks
described above.</p>

<h2 id="external-api-through-cross-document-messaging">External API through cross-document messaging</h2>

<p>Where supported, the test harness will also send messages using cross-document
messaging to each ancestor and opener browsing context. Since it uses the
wildcard keyword (*), cross-origin communication is enabled and script on
different origins can collect the results.</p>

<p>This API follows similar conventions as those described above only slightly
modified to accommodate message event API. Each message is sent by the harness
is passed a single vanilla object, available as the <code>data</code> property of the event
object. These objects are structures as follows:</p>

<ul>
<li>start - <code>{ type: "start" }</code></li>
<li>test_state - <code>{ type: "test_state", test: Test }</code></li>
<li>result - <code>{ type: "result", test: Test }</code></li>
<li>complete - <code>{ type: "complete", tests: [Test, ...], status: TestsStatus }</code></li>
</ul>

<h2 id="web-workers">Web Workers</h2>

<p>The <code>testharness.js</code> script can be used from within <a href="https://html.spec.whatwg.org/multipage/workers.html">dedicated workers, shared
workers</a> and <a href="https://slightlyoff.github.io/ServiceWorker/spec/service_worker/">service
workers</a>.</p>

<p>Testing from a worker script is different from testing from an HTML document in
several ways:</p>

<ul>
<li><p>Workers have no reporting capability since they are runing in the background.
Hence they rely on <code>testharness.js</code> running in a companion client HTML document
for reporting.</p></li>
<li><p>Shared and service workers do not have a unique client document since there
could be more than one document that communicates with these workers. So a
client document needs to explicitly connect to a worker and fetch test results
from it using <code>fetch_tests_from_worker</code>. This is true even for a dedicated
worker. Once connected, the individual tests running in the worker (or those
that have already run to completion) will be automatically reflected in the
client document.</p></li>
<li><p>The client document controls the timeout of the tests. All worker scripts act
as if they were started with the <code>explicit_timeout</code> option (see the <a href="#harness-timeout">Harness
timeout</a> section).</p></li>
<li><p>Dedicated and shared workers don't have an equivalent of an <code>onload</code> event.
Thus the test harness has no way to know when all tests have completed (see
<a href="#determining-when-all-tests-are-complete">Determining when all tests are
complete</a>). So these worker tests
behave as if they were started with the <code>explicit_done</code> option. Service
workers depend on the
<a href="https://slightlyoff.github.io/ServiceWorker/spec/service_worker/index.html#service-worker-global-scope-install-event">oninstall</a>
event and don't require an explicit <code>done</code> call.</p></li>
</ul>

<p>Here's an example that uses a dedicated worker.</p>

<p><code>worker.js</code>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">importScripts</span><span class="p">(</span><span class="s2">"/resources/testharness.js"</span><span class="p">);</span>

<span class="nx">test</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assert_true</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="s2">"true is true"</span><span class="p">);</span>
<span class="p">},</span> <span class="s2">"Simple test"</span><span class="p">);</span>

<span class="c1">// done() is needed because the testharness is running as if explicit_done</span>
<span class="c1">// was specified.</span>
<span class="nx">done</span><span class="p">();</span>
</code></pre></div>
<p><code>test.html</code>:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;title&gt;</span>Simple test<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/resources/testharness.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/resources/testharnessreport.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"log"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;script&gt;</span>

<span class="nx">fetch_tests_from_worker</span><span class="p">(</span><span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="s2">"worker.js"</span><span class="p">));</span>

<span class="nt">&lt;/script&gt;</span>
</code></pre></div>
<p>The argument to the <code>fetch_tests_from_worker</code> function can be a
<a href="https://html.spec.whatwg.org/multipage/workers.html#dedicated-workers-and-the-worker-interface"><code>Worker</code></a>,
a <a href="https://html.spec.whatwg.org/multipage/workers.html#shared-workers-and-the-sharedworker-interface"><code>SharedWorker</code></a>
or a <a href="https://slightlyoff.github.io/ServiceWorker/spec/service_worker/#service-worker-obj"><code>ServiceWorker</code></a>.
Once called, the containing document fetches all the tests from the worker and
behaves as if those tests were running in the containing document itself.</p>

<h2 id="list-of-assertions">List of Assertions</h2>

<h3 id="assert_true-actual-description-"><code>assert_true(actual, description)</code></h3>

<p>asserts that <code>actual</code> is strictly true</p>

<h3 id="assert_false-actual-description-"><code>assert_false(actual, description)</code></h3>

<p>asserts that <code>actual</code> is strictly false</p>

<h3 id="assert_equals-actual-expected-description-"><code>assert_equals(actual, expected, description)</code></h3>

<p>asserts that <code>actual</code> is the same value as <code>expected</code></p>

<h3 id="assert_not_equals-actual-expected-description-"><code>assert_not_equals(actual, expected, description)</code></h3>

<p>asserts that <code>actual</code> is a different value to <code>expected</code>.
This means that <code>expected</code> is a misnomer.</p>

<h3 id="assert_in_array-actual-expected-description-"><code>assert_in_array(actual, expected, description)</code></h3>

<p>asserts that <code>expected</code> is an Array, and <code>actual</code> is equal to one of the
members i.e. <code>expected.indexOf(actual) != -1</code></p>

<h3 id="assert_array_equals-actual-expected-description-"><code>assert_array_equals(actual, expected, description)</code></h3>

<p>asserts that <code>actual</code> and <code>expected</code> have the same
length and the value of each indexed property in <code>actual</code> is the strictly equal
to the corresponding property value in <code>expected</code></p>

<h3 id="assert_approx_equals-actual-expected-epsilon-description-"><code>assert_approx_equals(actual, expected, epsilon, description)</code></h3>

<p>asserts that <code>actual</code> is a number within Â±<code>epsilon</code> of <code>expected</code></p>

<h3 id="assert_less_than-actual-expected-description-"><code>assert_less_than(actual, expected, description)</code></h3>

<p>asserts that <code>actual</code> is a number less than <code>expected</code></p>

<h3 id="assert_greater_than-actual-expected-description-"><code>assert_greater_than(actual, expected, description)</code></h3>

<p>asserts that <code>actual</code> is a number greater than <code>expected</code></p>

<h3 id="assert_between_exclusive-actual-lower-upper-description"><code>assert_between_exclusive(actual, lower, upper, description</code></h3>

<p>asserts that <code>actual</code> is a number between <code>lower</code> and <code>upper</code> but not
equal to either of them</p>

<h3 id="assert_less_than_equal-actual-expected-description-"><code>assert_less_than_equal(actual, expected, description)</code></h3>

<p>asserts that <code>actual</code> is a number less than or equal to <code>expected</code></p>

<h3 id="assert_greater_than_equal-actual-expected-description-"><code>assert_greater_than_equal(actual, expected, description)</code></h3>

<p>asserts that <code>actual</code> is a number greater than or equal to <code>expected</code></p>

<h3 id="assert_between_inclusive-actual-lower-upper-description"><code>assert_between_inclusive(actual, lower, upper, description</code></h3>

<p>asserts that <code>actual</code> is a number between <code>lower</code> and <code>upper</code> or
equal to either of them</p>

<h3 id="assert_regexp_match-actual-expected-description-"><code>assert_regexp_match(actual, expected, description)</code></h3>

<p>asserts that <code>actual</code> matches the regexp <code>expected</code></p>

<h3 id="assert_class_string-object-class_name-description-"><code>assert_class_string(object, class_name, description)</code></h3>

<p>asserts that the class string of <code>object</code> as returned in
<code>Object.prototype.toString</code> is equal to <code>class_name</code>.</p>

<h3 id="assert_own_property-object-property_name-description-"><code>assert_own_property(object, property_name, description)</code></h3>

<p>assert that object has own property <code>property_name</code></p>

<h3 id="assert_inherits-object-property_name-description-"><code>assert_inherits(object, property_name, description)</code></h3>

<p>assert that object does not have an own property named
<code>property_name</code> but that <code>property_name</code> is present in the prototype
chain for object</p>

<h3 id="assert_idl_attribute-object-attribute_name-description-"><code>assert_idl_attribute(object, attribute_name, description)</code></h3>

<p>assert that an object that is an instance of some interface has the
attribute attribute_name following the conditions specified by WebIDL</p>

<h3 id="assert_readonly-object-property_name-description-"><code>assert_readonly(object, property_name, description)</code></h3>

<p>assert that property <code>property_name</code> on object is readonly</p>

<h3 id="assert_throws-code-func-description-"><code>assert_throws(code, func, description)</code></h3>

<p><code>code</code> - the expected exception. This can take several forms:</p>

<ul>
<li>string - the thrown exception must be a DOMException with the given
         name, e.g., "TimeoutError" (for compatibility with existing
         tests, a constant is also supported, e.g., "TIMEOUT_ERR")</li>
<li>object - the thrown exception must have a property called "name" that
         matches code.name</li>
<li>null -   allow any exception (in general, one of the options above
         should be used)</li>
</ul>

<p><code>func</code> - a function that should throw</p>

<h3 id="assert_unreached-description-"><code>assert_unreached(description)</code></h3>

<p>asserts if called. Used to ensure that some codepath is <em>not</em> taken e.g.
an event does not fire.</p>

<h3 id="assert_any-assert_func-actual-expected_array-extra_arg_1-extra_arg_n-"><code>assert_any(assert_func, actual, expected_array, extra_arg_1, ... extra_arg_N)</code></h3>

<p>asserts that one <code>assert_func(actual, expected_array_N, extra_arg1, ..., extra_arg_N)</code>
  is true for some <code>expected_array_N</code> in <code>expected_array</code>. This only works for <code>assert_func</code>
  with signature <code>assert_func(actual, expected, args_1, ..., args_N)</code>. Note that tests
  with multiple allowed pass conditions are bad practice unless the spec specifically
  allows multiple behaviours. Test authors should not use this method simply to hide
  UA bugs.</p>

<h3 id="assert_exists-object-property_name-description-"><code>assert_exists(object, property_name, description)</code></h3>

<p><strong>deprecated</strong>
asserts that object has an own property <code>property_name</code></p>

<h3 id="assert_not_exists-object-property_name-description-"><code>assert_not_exists(object, property_name, description)</code></h3>

<p><strong>deprecated</strong>
assert that object does not have own property <code>property_name</code></p>

<h2 id="metadata">Metadata</h2>

<p>It is possible to add optional metadata to tests; this can be done in
one of two ways; either by adding <code>&lt;meta&gt;</code> elements to the head of the
document containing the tests, or by adding the metadata to individual
<code>[async_]test</code> calls, as properties.</p>

  
</article>

        </div>
        <div role="complementary" class="col-md-3">
          <div class="panel-group affix-top" data-spy="affix" data-offset-top="169" data-offset-bottom="50">
            
              
<div id="toc-container" class="panel panel-primary" style="">
  <div class="panel-heading">
  <h4 class="panel-title">
    <a class="accordion-toggle" data-toggle="collapse" href="#toc">
      <b class="caret"></b> Table of Contents
      
    </a>
  </h4>
</div>

  <nav id="toc" class="collapse in list-group nav">
    <a class="list-group-item" href="#">Back to the top <span class="pull-right glyphicon glyphicon-circle_arrow_top"></span> </a>
  <a id="introduction-link" class="list-group-item" href="#introduction">Introduction</a><a id="basic-usage-link" class="list-group-item" href="#basic-usage">Basic Usage</a><a id="synchronous-tests-link" class="list-group-item" href="#synchronous-tests">Synchronous Tests</a><a id="asynchronous-tests-link" class="list-group-item" href="#asynchronous-tests">Asynchronous Tests</a><a id="promise-tests-link" class="list-group-item" href="#promise-tests">Promise Tests</a><a id="single-page-tests-link" class="list-group-item" href="#single-page-tests">Single Page Tests</a><a id="making-assertions-link" class="list-group-item" href="#making-assertions">Making assertions</a><a id="cleanup-link" class="list-group-item" href="#cleanup">Cleanup</a><a id="timeouts-in-tests-link" class="list-group-item" href="#timeouts-in-tests">Timeouts in Tests</a><a id="harness-timeout-link" class="list-group-item" href="#harness-timeout">Harness Timeout</a><a id="setup-link" class="list-group-item" href="#setup">Setup</a><a id="determining-when-all-tests-are-complete-link" class="list-group-item" href="#determining-when-all-tests-are-complete">Determining when all tests are complete</a><a id="generating-tests-link" class="list-group-item" href="#generating-tests">Generating tests</a><a id="callback-api-link" class="list-group-item" href="#callback-api">Callback API</a><a id="external-api-link" class="list-group-item" href="#external-api">External API</a><a id="external-api-through-cross-document-messaging-link" class="list-group-item" href="#external-api-through-cross-document-messaging">External API through cross-document messaging</a><a id="web-workers-link" class="list-group-item" href="#web-workers">Web Workers</a><a id="list-of-assertions-link" class="list-group-item" href="#list-of-assertions">List of Assertions</a><a id="assert_true-actual-description--link" class="list-group-item" href="#assert_true-actual-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_true(actual, description)</code></a><a id="assert_false-actual-description--link" class="list-group-item" href="#assert_false-actual-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_false(actual, description)</code></a><a id="assert_equals-actual-expected-description--link" class="list-group-item" href="#assert_equals-actual-expected-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_equals(actual, expected, description)</code></a><a id="assert_not_equals-actual-expected-description--link" class="list-group-item" href="#assert_not_equals-actual-expected-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_not_equals(actual, expected, description)</code></a><a id="assert_in_array-actual-expected-description--link" class="list-group-item" href="#assert_in_array-actual-expected-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_in_array(actual, expected, description)</code></a><a id="assert_array_equals-actual-expected-description--link" class="list-group-item" href="#assert_array_equals-actual-expected-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_array_equals(actual, expected, description)</code></a><a id="assert_approx_equals-actual-expected-epsilon-description--link" class="list-group-item" href="#assert_approx_equals-actual-expected-epsilon-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_approx_equals(actual, expected, epsilon, description)</code></a><a id="assert_less_than-actual-expected-description--link" class="list-group-item" href="#assert_less_than-actual-expected-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_less_than(actual, expected, description)</code></a><a id="assert_greater_than-actual-expected-description--link" class="list-group-item" href="#assert_greater_than-actual-expected-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_greater_than(actual, expected, description)</code></a><a id="assert_between_exclusive-actual-lower-upper-description-link" class="list-group-item" href="#assert_between_exclusive-actual-lower-upper-description">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_between_exclusive(actual, lower, upper, description</code></a><a id="assert_less_than_equal-actual-expected-description--link" class="list-group-item" href="#assert_less_than_equal-actual-expected-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_less_than_equal(actual, expected, description)</code></a><a id="assert_greater_than_equal-actual-expected-description--link" class="list-group-item" href="#assert_greater_than_equal-actual-expected-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_greater_than_equal(actual, expected, description)</code></a><a id="assert_between_inclusive-actual-lower-upper-description-link" class="list-group-item" href="#assert_between_inclusive-actual-lower-upper-description">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_between_inclusive(actual, lower, upper, description</code></a><a id="assert_regexp_match-actual-expected-description--link" class="list-group-item" href="#assert_regexp_match-actual-expected-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_regexp_match(actual, expected, description)</code></a><a id="assert_class_string-object-class_name-description--link" class="list-group-item" href="#assert_class_string-object-class_name-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_class_string(object, class_name, description)</code></a><a id="assert_own_property-object-property_name-description--link" class="list-group-item" href="#assert_own_property-object-property_name-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_own_property(object, property_name, description)</code></a><a id="assert_inherits-object-property_name-description--link" class="list-group-item" href="#assert_inherits-object-property_name-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_inherits(object, property_name, description)</code></a><a id="assert_idl_attribute-object-attribute_name-description--link" class="list-group-item" href="#assert_idl_attribute-object-attribute_name-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_idl_attribute(object, attribute_name, description)</code></a><a id="assert_readonly-object-property_name-description--link" class="list-group-item" href="#assert_readonly-object-property_name-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_readonly(object, property_name, description)</code></a><a id="assert_throws-code-func-description--link" class="list-group-item" href="#assert_throws-code-func-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_throws(code, func, description)</code></a><a id="assert_unreached-description--link" class="list-group-item" href="#assert_unreached-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_unreached(description)</code></a><a id="assert_any-assert_func-actual-expected_array-extra_arg_1-extra_arg_n--link" class="list-group-item" href="#assert_any-assert_func-actual-expected_array-extra_arg_1-extra_arg_n-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_any(assert_func, actual, expected_array, extra_arg_1, ... extra_arg_N)</code></a><a id="assert_exists-object-property_name-description--link" class="list-group-item" href="#assert_exists-object-property_name-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_exists(object, property_name, description)</code></a><a id="assert_not_exists-object-property_name-description--link" class="list-group-item" href="#assert_not_exists-object-property_name-description-">&nbsp;&nbsp;&nbsp;&nbsp;<code>assert_not_exists(object, property_name, description)</code></a><a id="metadata-link" class="list-group-item" href="#metadata">Metadata</a></nav>
</div>


<div id="docs-toc">
  
  <div class="panel panel-default">
    
    
    
      
     
    <div class="panel-heading">
  <h4 class="panel-title">
    <a class="collapsed accordion-toggle" data-toggle="collapse" data-parent="#docs-toc" href="#docs-sidebar-configuration">
      <b class="caret"></b> Getting Started
      <span class="pull-right glyphicon glyphicon-settings">
    </span></a>
  </h4>
</div>

    <nav class="collapse list-group" id="docs-sidebar-configuration">
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/configuration.html">
  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
Getting Started</a>
        
    </nav>
  </div>
  
  <div class="panel panel-default">
    
    
    
      
     
    <div class="panel-heading">
  <h4 class="panel-title">
    <a class="collapsed accordion-toggle" data-toggle="collapse" data-parent="#docs-toc" href="#docs-sidebar-writingtests">
      <b class="caret"></b> Writing Tests
      <span class="pull-right glyphicon glyphicon-pencil">
    </span></a>
  </h4>
</div>

    <nav class="collapse list-group" id="docs-sidebar-writingtests">
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/writing-tests.html">
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
Writing Tests</a>
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/bugs/index.html">
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
web-platform-tests bugs</a>
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/test-format-guidelines.html">
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
Test Format Guidelines</a>
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/test-style-guidelines.html">
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
Test Style Guidelines</a>
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/testharness.html">
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
Writing Javascript Tests</a>
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/reftests.html">
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
Writing Reftests</a>
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/manual-test.html">
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
Writing Manual Tests</a>
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/css-naming.html">
  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
CSS Naming Guidelines</a>
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/css-metadata.html">
  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
CSS Metadata</a>
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/lint-tool.html">
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
Lint tool</a>
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/test-templates.html">
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
Test Templates</a>
        
    </nav>
  </div>
  
  <div class="panel panel-default">
    
    
    
      
     
    <div class="panel-heading">
  <h4 class="panel-title">
    <a class="collapsed accordion-toggle" data-toggle="collapse" data-parent="#docs-toc" href="#docs-sidebar-running">
      <b class="caret"></b> Running Tests
      <span class="pull-right glyphicon glyphicon-play">
    </span></a>
  </h4>
</div>

    <nav class="collapse list-group" id="docs-sidebar-running">
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/running_tests.html">
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
Running Tests</a>
        
    </nav>
  </div>
  
  <div class="panel panel-default">
    
    
    
      
     
    <div class="panel-heading">
  <h4 class="panel-title">
    <a class="collapsed accordion-toggle" data-toggle="collapse" data-parent="#docs-toc" href="#docs-sidebar-submitting">
      <b class="caret"></b> Submitting Tests
      <span class="pull-right glyphicon glyphicon-git_pull_request">
    </span></a>
  </h4>
</div>

    <nav class="collapse list-group" id="docs-sidebar-submitting">
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/submission-process.html">
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
Test Submission Process</a>
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/github-101.html">
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
Github Test Submission</a>
        
    </nav>
  </div>
  
  <div class="panel panel-default">
    
    
    
      
     
    <div class="panel-heading">
  <h4 class="panel-title">
    <a class="collapsed accordion-toggle" data-toggle="collapse" data-parent="#docs-toc" href="#docs-sidebar-review">
      <b class="caret"></b> Reviewing Tests
      <span class="pull-right glyphicon glyphicon-search">
    </span></a>
  </h4>
</div>

    <nav class="collapse list-group" id="docs-sidebar-review">
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/review-process.html">
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
Test Review and Approval Process</a>
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/review-checklist.html">
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
Test Review Checklist</a>
        
    </nav>
  </div>
  
  <div class="panel panel-default">
    
    
    
      
     
    <div class="panel-heading">
  <h4 class="panel-title">
    <a class="collapsed accordion-toggle" data-toggle="collapse" data-parent="#docs-toc" href="#docs-sidebar-bugs">
      <b class="caret"></b> Reporting Bugs
      <span class="pull-right glyphicon glyphicon-bug">
    </span></a>
  </h4>
</div>

    <nav class="collapse list-group" id="docs-sidebar-bugs">
        
          
          <a class="list-group-item" href="http://testthewebforward.org/docs/bugs.html">
  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
How to Report a Bug</a>
        
    </nav>
  </div>
  
</div>


            
            <br>

          </div>
        </div>
      </div>
    
  </div>
  
  <footer>
  <div class="container">
    <div class="col-md-4">
       <p>Copyright Â© 2014 <a href="http://www.w3.org/">W3C</a><sup>Â®</sup> (<a href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute of Technology">MIT</acronym></a>, <a href="http://www.ercim.eu/"><acronym title="European Research Consortium for Informatics and Mathematics">ERCIM</acronym></a>,
     <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>).</p>
    </div>
    <div class="col-md-4">
      <p class="text-center"><a href="http://testthewebforward.org/"><img src="Testharness.js%20API%20Documentation%20%7C%20Test%20the%20Web%20Forward_files/dinos-174x40.png" alt="Dinos" height="40" width="174"></a></p>
    </div>
    <div class="col-md-4">
      <p class="text-right">
        <a href="http://testthewebforward.org/discuss.html">Discuss</a> |
        <a href="http://testthewebforward.org/docs/open-source.html">Contribute</a> |
        <a href="http://testthewebforward.org/terms.html">Terms</a> |
        <a href="http://testthewebforward.org/sponsors.html">Sponsors</a>
      </p>
    </div>
  </div>
</footer>

  
  
    <a class="visible-lg" href="http://testthewebforward.org/docs/forkme.html"><img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000" src="Testharness.js%20API%20Documentation%20%7C%20Test%20the%20Web%20Forward_files/forkme.png" alt="Fork me on GitHub"></a>
  
  
  <script type="text/javascript" defer="defer" async="" src="Testharness.js%20API%20Documentation%20%7C%20Test%20the%20Web%20Forward_files/a.html"></script><script src="Testharness.js%20API%20Documentation%20%7C%20Test%20the%20Web%20Forward_files/jquery-1.js"></script>
  <script src="Testharness.js%20API%20Documentation%20%7C%20Test%20the%20Web%20Forward_files/bootstrap.js"></script>
  <script>
  var _scrollspy_refresh = $.fn.scrollspy.Constructor.prototype.refresh;
  
  $.fn.scrollspy.Constructor.prototype.refresh = function() {
    this.selector = this.selector.replace("li > ", "> ");
    return _scrollspy_refresh.call(this);
  }
  $.fn.scrollspy.Constructor.prototype.activate = function (target) {
    this.activeTarget = target

    $(this.selector)
      .removeClass('active')

    var selector = this.selector
      + '[data-target="' + target + '"],'
      + this.selector + '[href="' + target + '"]'
    var active = $(selector).addClass('active')

    active.trigger('activate')
  }
  
    var ICONS = {};
  

    function getIcon(id) {
      id = id.split('-')[0];
      var icon = ICONS[id];
      if (!icon) return "";
      return "<span class=\"glyphicon glyphicon-" + icon + "\"></span> ";
    }

    function getAnchor(id) {
      return " <small><a class=anchor href=\"#" + id + "\"><span class=\"glyphicon glyphicon-link\"></span></a></small>";
    }
    var $toc = $("#toc");
    if ($toc.length) {
      var $headers = $("*[role=main] h2, .docs *[role=main] h3, .event-kits *[role=main] h3");
      if ($headers.length) {
        $toc.parents(".panel").show();
        $headers.each(function() {
          var $header = $(this);
          var id = this.id || $header.text().replace(/\W+/g, '-').toLowerCase();
          this.id = id;
          var icon = getIcon(id);
          var text = $header.html();
          if (icon) {
            $header.prepend(icon);
            text += icon.replace("class=\"", "class=\"pull-right "); // UGLIEST
          }
          // Indent h3 subheaders
          if($header.get(0).nodeName.toLowerCase() == "h3") {
              text = "&nbsp;&nbsp;&nbsp&nbsp;"+text
          }
          $("<a id=\"" + id + "-link\" class=\"list-group-item\" href=\"#" + id + "\">" + text  + "</a>").appendTo($toc);
        });
      }
    }
    $('.auto-popover').popover();
  </script>
  <script>
var _paq = _paq || [];
_paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
_paq.push(["trackPageView"]);
(function() {
var u=(("https:" == document.location.protocol) ? "https" : "http") + "://tracking.webplatform.org/";
_paq.push(["setTrackerUrl", u+"js/"]);
_paq.push(["setSiteId", "7"]);
var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
g.defer=true; g.async=true; g.src=u+"js/"; s.parentNode.insertBefore(g,s);
})();
</script>


</body></html>